<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MC Ranked Ladder</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
    h1 { margin: 0 0 10px; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0 16px; }
    select, input { padding: 8px; font-size: 14px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border-bottom: 1px solid #ddd; padding: 10px; text-align: left; }
    th { position: sticky; top: 0; background: #fff; z-index: 1; }
    .muted { color: #666; font-size: 13px; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; border: 1px solid #ddd; font-size: 12px; }
    .kit-card { border: 1px solid #ddd; border-radius: 12px; padding: 12px; margin: 10px 0; }
    .kit-title { margin: 0 0 6px; font-size: 16px; }
    .kit-pre { white-space: pre-wrap; margin: 0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 13px; }

    .hero{ padding:26px 0 18px; }
    .hero-kicker{ font-size:12px; color:#666; text-transform:uppercase; letter-spacing:.12em; }
    .hero-title{ margin:6px 0 8px; font-size:36px; line-height:1.1; }
    .hero-sub{ margin:0 0 14px; color:#444; max-width:720px; }
    .hero-cta{ display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
  display:inline-block; padding:10px 14px; border-radius:10px;
  background:#111; color:#fff; text-decoration:none; font-size:14px;
}
    .btn-ghost{ background:#fff; color:#111; border:1px solid #ddd; }

    .grid{
  display:grid; gap:12px;
  grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
  margin:14px 0;
}
    .card{
  border:1px solid #ddd; border-radius:12px; padding:12px;
}
    .card h3{ margin:0 0 6px; font-size:15px; }
    .card p{ margin:0; color:#444; font-size:13px; }

    .section-divider{ margin:18px 0; border:none; border-top:1px solid #eee; }

    /* ===== Dark Tier-Board Theme (drop-in) ===== */
:root{
  --bg: #0f141b;
  --panel: #151b23;
  --panel2: #111722;
  --text: #e8eef7;
  --muted: #a9b4c2;
  --border: rgba(255,255,255,0.10);

  /* Tier colors (left bar vibe) */
  --tierS: #ff6a6a;
  --tierA: #ffb55c;
  --tierB: #ffe36b;
  --tierC: #b8ff6b;
  --tierD: #6bd8ff;
  --tierE: #7d7bff;
  --tierF: #c56bff;
}

html, body { background: var(--bg); color: var(--text); }
body { margin: 0; padding: 22px; }

h1, h2 { color: var(--text); letter-spacing: 0.2px; }

.muted { color: var(--muted) !important; }

/* Controls */
.controls{
  background: linear-gradient(180deg, var(--panel), var(--panel2));
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px;
  margin: 14px 0 16px;
}

select, input{
  background: rgba(255,255,255,0.06);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 12px;
  outline: none;
}

select:focus, input:focus{
  border-color: rgba(255,255,255,0.22);
  box-shadow: 0 0 0 3px rgba(109,216,255,0.12);
}

/* Table */
table{
  background: linear-gradient(180deg, var(--panel), var(--panel2));
  border: 1px solid var(--border);
  border-radius: 14px;
  overflow: hidden;
}

th{
  background: rgba(255,255,255,0.04) !important;
  color: var(--muted);
  border-bottom: 1px solid var(--border);
}

td{
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

tr:hover td{
  background: rgba(255,255,255,0.03);
}

/* Pills */
.pill{
  border: 1px solid var(--border) !important;
  background: rgba(255,255,255,0.05);
  color: var(--text);
}

/* Tier pill colors */
.pill:empty { display:none; }
.pill{ font-weight: 700; }

.pill::before{ content:""; } /* no change; keeps your HTML same */

td:nth-child(4) .pill{ /* Tier column pill */
  padding: 2px 10px;
}

/* Map S/A/B/C/D/E/F to colors using attribute selectors */
td:nth-child(4) .pill{ position: relative; }
td:nth-child(4) .pill::before{
  content:"";
  display:inline-block;
  width:8px; height:8px;
  border-radius:999px;
  margin-right:8px;
  vertical-align: middle;
  background: rgba(255,255,255,0.25);
}

/* These work because your tier text is literally S, A, B... */
td:nth-child(4) .pill:has(::before){}

td:nth-child(4) .pill{
  box-shadow: 0 0 0 1px rgba(255,255,255,0.02);
}

/* Fallback approach: set dot colors using text matching via JS? Not needed.
   Instead: simple manual color per tier using data-* would be best.
   Since we can't change HTML, we’ll color by exact text with :is() + attribute not possible in pure CSS.
   So we color the whole pill with a subtle glow using JS-free approach:
*/
td:nth-child(4) .pill{
  background: rgba(255,255,255,0.06);
}

/* Kits cards */
.kit-card{
  background: linear-gradient(180deg, var(--panel), var(--panel2));
  border: 1px solid var(--border);
  border-radius: 14px;
}

.kit-title{
  color: var(--text);
  font-weight: 800;
}

.kit-pre{
  color: var(--text);
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 12px;
  padding: 10px;
}

/* Divider */
hr{
  border: none;
  border-top: 1px solid rgba(255,255,255,0.10);
}

/* Status text spacing */
#status{ margin-top: 4px; }

    /* ===== Exact Tier Colors ===== */
:root{
  --tierS: #f37474;
  --tierA: #efb675;
  --tierB: #edd27a;
  --tierC: #e6ef73;
  --tierD: #aee86e;
  --tierE: #7b7ce6;
  --tierF: #b07bb3;
}

/* Tier Pill Base */
td:nth-child(4) .pill{
  font-weight: 700;
  border: none !important;
  color: #111;
}

/* S */
td:nth-child(4) .pill:contains("S"){ background: var(--tierS); }

/* A */
td:nth-child(4) .pill:contains("A"){ background: var(--tierA); }

/* B */
td:nth-child(4) .pill:contains("B"){ background: var(--tierB); }

/* C */
td:nth-child(4) .pill:contains("C"){ background: var(--tierC); }

/* D */
td:nth-child(4) .pill:contains("D"){ background: var(--tierD); }

/* E */
td:nth-child(4) .pill:contains("E"){ background: var(--tierE); color:#fff; }

/* F */
td:nth-child(4) .pill:contains("F"){ background: var(--tierF); color:#fff; }

/* ===== Improve Font Readability ===== */

/* Use a stronger modern font stack */
body {
  font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont,
               "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
               "Helvetica Neue", sans-serif;
  font-weight: 500;
  color: #eaf1ff;
}

/* Make headings clearer */
h1, h2, h3 {
  font-weight: 700;
  color: #ffffff;
  letter-spacing: 0.3px;
}

/* Improve card titles */
.card h3 {
  font-size: 16px;
  font-weight: 700;
  color: #ffffff;
}

/* Improve card text */
.card p {
  font-size: 14px;
  color: #cfd8e6;
}

/* Improve link visibility */
a {
  color: #9fc7ff;
  font-weight: 600;
  text-decoration: none;
}

a:hover {
  color: #ffffff;
  text-decoration: underline;
}

/* Improve muted text */
.muted {
  color: #a8b3c7 !important;
}

/* Make table text stronger */
td, th {
  font-size: 14px;
  font-weight: 500;
}

/* ===== Perfect Centered Tier Circle ===== */

td:nth-child(4) .pill {
  width: 28px;
  height: 28px;

  display: flex;                 /* stronger centering than inline-flex */
  align-items: center;
  justify-content: center;

  border-radius: 50%;
  font-weight: 700;
  font-size: 13px;
  line-height: 1;                /* prevents vertical shift */
  padding: 0;
  margin: 0 auto;                /* keeps it centered in the cell */

  border: none;
}

/* Tier Colors */
.tier-S { background: #f37474; }
.tier-A { background: #efb675; }
.tier-B { background: #edd27a; }
.tier-C { background: #e6ef73; }
.tier-D { background: #aee86e; }
.tier-E { background: #7b7ce6; color: #fff; }
.tier-F { background: #b07bb3; color: #fff; }

.kit-pre {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

.kit-pre li {
  position: relative;
  padding-left: 16px;
  margin: 6px 0;
}

.kit-pre li::before {
  content: "";
  position: absolute;
  left: 0;
  top: 8px;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #9fc7ff;
}

    /* ===== Hero Subtitle Brighter ===== */
.hero-sub {
  color: #cfd8e6;          /* brighter than muted */
  font-weight: 500;
}

/* ===== Stronger View Ladder Button ===== */
.btn {
  background: linear-gradient(135deg, #5f8cff, #7d7bff);
  color: #ffffff;
  font-weight: 600;
  border-radius: 12px;
  padding: 12px 18px;
  box-shadow: 0 6px 18px rgba(125,123,255,0.35);
  transition: all 0.2s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(125,123,255,0.45);
}

/* ===== Perfect Clean Tier Circle ===== */

td:nth-child(4) .pill {
  display: grid !important;
  place-items: center !important;   /* perfect centering */

  width: 28px !important;
  height: 28px !important;

  border-radius: 50% !important;

  padding: 0 !important;
  margin: 0 auto !important;

  border: none !important;
  box-shadow: none !important;

  font-weight: 700 !important;
  font-size: 13px !important;
  line-height: 1 !important;

  text-align: center !important;
}
    
/* tier colors */
td:nth-child(4) .tier-S { background: #f37474 !important; }
td:nth-child(4) .tier-A { background: #efb675 !important; }
td:nth-child(4) .tier-B { background: #edd27a !important; }
td:nth-child(4) .tier-C { background: #e6ef73 !important; }
td:nth-child(4) .tier-D { background: #aee86e !important; }
td:nth-child(4) .tier-E { background: #7b7ce6 !important; color: #fff !important; }
td:nth-child(4) .tier-F { background: #b07bb3 !important; color: #fff !important; }

td:nth-child(4) .pill::before {
  display: none !important;
  content: none !important;
}

    .tabbtn{
  appearance:none;
  border:1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color:#eaf1ff;
  padding:10px 14px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
}
.tabbtn.active{
  background: linear-gradient(135deg, #5f8cff, #7d7bff);
  border-color: transparent;
}

.tier-row{
  display:grid;
  grid-template-columns: 70px 1fr;
  gap:12px;
  margin:12px 0;
  padding:12px;
  border:1px solid rgba(255,255,255,0.10);
  border-radius:14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
}

.tier-label{
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  border-radius:12px;
  color:#111;
  height:56px;
}

.tier-chips{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:flex-start;
}

.chip{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
}

.chip strong{ font-size:14px; }
.chip span{ font-size:12px; color:#cfd8e6; }

/* exact tier colors you wanted */
.tS{ background:#f37474; }
.tA{ background:#efb675; }
.tB{ background:#edd27a; }
.tC{ background:#e6ef73; }
.tD{ background:#aee86e; }
.tE{ background:#7b7ce6; color:#fff; }
.tF{ background:#b07bb3; color:#fff; }
    
  </style>
</head>
<body>


<section class="hero">
  <div class="hero-kicker">Competitive SMP Ladder</div>
  <h1 class="hero-title">NapMC Ranked Ladder</h1>
  <p class="hero-sub">
    Transparent ELO rankings + official kits. Updated live from Google Sheets.
  </p>
  <div class="hero-cta">
    <a class="btn" href="#ladder">View Ladder</a>
  </div>
</section>

<section class="grid" id="info">
  <div class="card">
    <h3>Standardized Kits</h3>
    <p>Same gear, same rules. No arguing—just results.</p>
  </div>
  <div class="card">
    <h3>Skill-Based Ranking</h3>
    <p>ELO adjusts based on opponent strength.</p>
  </div>
  <div class="card">
    <h3>Regions Supported</h3>
    <p>EU / NA coexist with clear filtering.</p>
  </div>
</section>

<section class="grid" id="connect">
  <div class="card">
    <h3>Server IP</h3>
    <p><code>NapMC.net</code></p>
  </div>
  <div class="card">
    <h3>Rules / Kits</h3>
    <p><a href="#kits">Open →</a></p>
  </div>
  <div class="card">
    <h3>Live Ladder</h3>
    <p><a href="#ladder">Open →</a></p>
  </div>
</section>

<hr class="section-divider" />
  
  <h1>MC Ranked Ladder</h1>
  <div class="muted" id="status">Loading…</div>

  <div class="controls" style="justify-content:flex-start;">
  <button class="tabbtn" id="tabLadder">View Ladder</button>
  <button class="tabbtn" id="tabTier">View Tierlist</button>
</div>

<div id="viewLadder">
  
  <div class="controls">
    <input id="search" placeholder="Search player…" />
    <select id="region">
      <option value="">All Regions</option>
      <option value="NA">NA</option>
      <option value="EU">EU</option>
    </select>
    <select id="tier">
      <option value="">All Tiers</option>
      <option value="S">S</option><option value="A">A</option><option value="B">B</option>
      <option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option>
    </select>
    <select id="sort">
      <option value="rating_desc">Sort: Rating (high → low)</option>
      <option value="rating_asc">Sort: Rating (low → high)</option>
      <option value="wins_desc">Sort: Wins (high → low)</option>
      <option value="wr_desc">Sort: Win% (high → low)</option>
      <option value="matches_desc">Sort: Matches (high → low)</option>
    </select>
  </div>

<h2>Ranked Kits</h2>
<div class="muted">Auto-updates from the Kits tab in Google Sheets.</div>
<div id="kits"></div>
<hr style="margin:18px 0;" />

  <section id="ladder">
  <!-- keep all your current ladder HTML exactly as-is below this line -->
    
  <table>
    <thead>
      <tr>
        <th style="width:70px;">Rank</th>
        <th>Player</th>
        <th style="width:90px;">Region</th>
        <th style="width:90px;">Tier</th>
        <th style="width:110px;">Rating</th>
        <th style="width:90px;">W</th>
        <th style="width:90px;">L</th>
        <th style="width:110px;">Win%</th>
        <th style="width:110px;">Matches</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

    </div>

<div id="viewTier" style="display:none;">
  <h2>Tier List</h2>
  <div class="muted">Auto-sorted by ELO. Updates live from Google Sheets.</div>
  <div id="tierBoard"></div>
</div>

  
    </section>
  
<script>
  // Your published sheet base:
  const BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTPhJ75e207ll1_Tl6cyiX72A0dbepjDvC7ZUnI6gxS1ymrvG6vzjFxi03GeXgAop_gwPYgsg48-jRW";

  // Pull tabs as CSV
  const PLAYERS_CSV = `${BASE}/pub?output=csv&sheet=${encodeURIComponent("Players")}`;
  const KITS_CSV = `${BASE}/pub?output=csv&gid=791037356`;

  function parseCSV(csvText) {
    // Minimal CSV parser (handles quotes)
    const rows = [];
    let row = [], cur = "", inQuotes = false;
    for (let i = 0; i < csvText.length; i++) {
      const ch = csvText[i];
      const next = csvText[i+1];
      if (ch === '"' && inQuotes && next === '"') { cur += '"'; i++; continue; }
      if (ch === '"') { inQuotes = !inQuotes; continue; }
      if (ch === "," && !inQuotes) { row.push(cur); cur = ""; continue; }
      if ((ch === "\n" || ch === "\r") && !inQuotes) {
        if (cur.length || row.length) { row.push(cur); rows.push(row); }
        row = []; cur = "";
        continue;
      }
      cur += ch;
    }
    if (cur.length || row.length) { row.push(cur); rows.push(row); }
    return rows;
  }

  function pct(n) { return isFinite(n) ? `${Math.round(n * 1000) / 10}%` : ""; }

  // ----------- KITS (FIXED: top-level functions) -----------
  function escapeHtml(s) {
    return (s || "").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    })[c]);
  }

  function renderKits(kits) {
    const el = document.getElementById("kits");
    if (!el) return;

    if (!kits.length) {
      el.innerHTML = `<div class="muted">No kits found. Add a sheet tab named <strong>Kits</strong> with columns: Mode, Kit, Notes.</div>`;
      return;
    }

    el.innerHTML = kits.map(k => `
      <div class="kit-card">
        <h3 class="kit-title">${escapeHtml(k.mode)}</h3>
        <ul class="kit-pre">
  ${escapeHtml(k.kit)
    .split(/\r?\n/)
    .filter(line => line.trim())
    .map(line => `<li>${line}</li>`)
    .join("")}
</ul>
        ${k.notes ? `<div class="muted" style="margin-top:8px;">${escapeHtml(k.notes)}</div>` : ""}
      </div>
    `).join("");
  }
async function loadKits() {
  const res = await fetch(KITS_CSV, { cache: "no-store" }); // MUST be KITS_CSV
  if (!res.ok) throw new Error("Kits CSV fetch failed");
  const csv = await res.text();
  const rows = parseCSV(csv);

  // Expect header row then data:
  // Mode, Kit, Notes
  const data = rows.slice(1).filter(r => (r[0] || "").trim());
  const kits = data.map(r => ({
    mode: (r[0] || "").trim(),
    kit: (r[1] || "").trim(),
    notes: (r[2] || "").trim(),
  }));

  renderKits(kits);
}
 
  // ---------------------------------------------------------

  let players = [];

  function render() {
    const search = document.getElementById("search").value.trim().toLowerCase();
    const region = document.getElementById("region").value;
    const tier = document.getElementById("tier").value;
    const sort = document.getElementById("sort").value;

    let filtered = players.filter(p => {
      if (region && p.region !== region) return false;
      if (tier && p.tier !== tier) return false;
      if (search && !p.player.toLowerCase().includes(search)) return false;
      return true;
    });

    const sorters = {
      rating_desc: (a,b) => b.rating - a.rating,
      rating_asc:  (a,b) => a.rating - b.rating,
      wins_desc:   (a,b) => b.wins - a.wins,
      wr_desc:     (a,b) => (b.winRate - a.winRate),
      matches_desc:(a,b) => b.matches - a.matches,
    };
    filtered.sort(sorters[sort] || sorters.rating_desc);

    const tbody = document.getElementById("rows");
    tbody.innerHTML = "";

    filtered.forEach((p, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${idx + 1}</td>
        <td><strong>${p.player}</strong></td>
        <td><span class="pill">${p.region || ""}</span></td>
        <td><span class="pill">${p.tier || ""}</span></td>
        <td>${Math.round(p.rating)}</td>
        <td>${p.wins}</td>
        <td>${p.losses}</td>
        <td>${pct(p.winRate)}</td>
        <td>${p.matches}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById("status").textContent =
      `Showing ${filtered.length} player(s). Refreshes every 30 seconds.`;

     applyTierColors();
    
  }

  async function loadPlayers() {
    const res = await fetch(PLAYERS_CSV, { cache: "no-store" });
    if (!res.ok) throw new Error("CSV fetch failed");
    const csv = await res.text();
    const rows = parseCSV(csv);

    // Region, Players, StartRating, Rating, Wins, Losses, Matches, Tier
    const data = rows.slice(1).filter(r => r[1] && r[1].trim());

    players = data.map(r => {
      const region = (r[0] || "").trim();
      const player = (r[1] || "").trim();
      const rating = Number(r[3]) || 0;
      const wins = Number(r[4]) || 0;
      const losses = Number(r[5]) || 0;
      const matches = Number(r[6]) || (wins + losses);
      const tier = (r[7] || "").trim();
      const winRate = (wins + losses) > 0 ? wins / (wins + losses) : 0;
      return { region, player, rating, wins, losses, matches, tier, winRate };
    });

    render();
    renderTierlist();
  }

function renderTierlist(){
  const tiers = ["S","A","B","C","D","E","F"];
  const tierBoard = document.getElementById("tierBoard");
  if(!tierBoard) return;

  const tierClass = {S:"tS",A:"tA",B:"tB",C:"tC",D:"tD",E:"tE",F:"tF"};

  // group players by tier
  const groups = {};
  tiers.forEach(t => groups[t] = []);

  players.forEach(p => {
    const t = (p.tier || "").trim();
    if(groups[t]) groups[t].push(p);
  });

  // sort each tier by rating desc
  tiers.forEach(t => groups[t].sort((a,b)=> b.rating - a.rating));

  tierBoard.innerHTML = tiers.map(t => `
    <div class="tier-row">
      <div class="tier-label ${tierClass[t]}">${t}</div>
      <div class="tier-chips">
        ${groups[t].length ? groups[t].map(p => `
          <div class="chip">
            <strong>${p.player}</strong>
            <span>${Math.round(p.rating)} • ${p.region || ""}</span>
          </div>
        `).join("") : `<div class="muted">No players</div>`}
      </div>
    </div>
  `).join("");
}
  
function applyTierColors(){
  document.querySelectorAll("td:nth-child(4) .pill").forEach(p => {
    const tier = p.textContent.trim();
    p.className = "pill tier-" + tier;
  });
}
  

  ["search","region","tier","sort"].forEach(id => {
    document.getElementById(id).addEventListener("input", render);
    document.getElementById(id).addEventListener("change", render);
  });

  loadPlayers().catch(err => {
    console.error(err);
    document.getElementById("status").textContent =
      "Could not load the Players tab. Make sure your tab is named 'Players' and the sheet is published to the web.";
  });

  loadKits().catch(err => { console.error(err); });

  setInterval(() => loadPlayers().catch(()=>{}), 30000);
  setInterval(() => loadKits().catch(()=>{}), 30000);

function setView(which){
  const ladder = document.getElementById("viewLadder");
  const tier = document.getElementById("viewTier");
  const b1 = document.getElementById("tabLadder");
  const b2 = document.getElementById("tabTier");

  const showLadder = which === "ladder";
  ladder.style.display = showLadder ? "" : "none";
  tier.style.display = showLadder ? "none" : "";

  b1.classList.toggle("active", showLadder);
  b2.classList.toggle("active", !showLadder);
}

// default
setView("ladder");

document.getElementById("tabLadder").addEventListener("click", () => setView("ladder"));
document.getElementById("tabTier").addEventListener("click", () => setView("tier"));
  
</script>
</body>
</html>
